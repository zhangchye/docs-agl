<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <meta name="description" content=" ">

    <title>
	    AGL Developer Site - 
        
            
                System Hardening  -
            
        
    </title>

    <link rel="SHORTCUT ICON" href="/favicon.ico"/>

    

    
    

    <link rel="canonical" href="http://docs.automotivelinux.org/docs/architecture/en/dev/reference/security/07-system-hardening.html">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/static/styles/main.css">
    <link rel="stylesheet" type="text/css" href="/static/styles/syntax.css">
    <!-- Algolia Search CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />

    <!-- Fonts -->
    <!-- For attribution information, see www/attributions.html -->
    <link href='https://fonts.googleapis.com/css?family=Raleway:700,400,300,700italic,400italic,300italic' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- <script defer type="text/javascript">
        var disqus_developer = ; // this would set it to developer mode
    </script>-->

    <!-- JS -->
    <script defer type="text/javascript" src="/static/js/lib/jquery-2.1.1.min.js"></script>
    <script defer type="text/javascript" src="/static/js/lib/bootstrap.min.js"></script>
<!--    <script defer type="text/javascript" src="/static/js/lib/ZeroClipboard.js"></script>-->

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', '{}', 'auto');
    ga('send', 'pageview');
</script>

</head>

<body>
    <header>
    <a class="scroll-point pt-top" name="top"></a>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="/"><img id="logo_top" src="/static/img/branding/agl_title_793x211.png"/></a>
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <div class="nav_bar_left">
                    <ul class="nav navbar-nav">
                        <li >
                            <a href="/docs/getting_started/en/dev/">Getting Started</a>
                        </li>
                                                
                        <li >
                            <a href="/docs/architecture/en/dev/">Architecture Guides</a>
                        </li>

                        <li >
                            <a href="/docs/hardware/en/dev/">Hardware Support</a>
                        </li>

                        <li >
                            <a href="/docs/devguides/en/dev/">Developer Guides</a>
                        </li>
                        
                        <li >
                            <a href="/docs/apis_services/en/dev/">APIs & Services</a>
                        </li>
					</ul>
				</div>
                <div class="nav_bar_right">
                    <ul class="nav navbar-nav">
                        <li >
                            <a href="/techpost" id="blog_button">TechPost<span class="badge" id="new_blog_count"></span></a>
                        </li>
                        <li >
                            <a href="/contribute">Contribute</a>
                        </li>
                        <li>
                            <form class="navbar-form navbar-right" id="header-search-form" role="search">
                                <div class="input-group">
                                    
                                    <input id="header-search-field" type="text" placeholder="Search 'dev' docs..." class="form-control hidden-xs" autocomplete="off">
                                </div>
                            </form>
                        </li>
                    </ul>
                </div>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    <div id="_fixed_navbar_spacer" style="padding-top:50px"></div>
</header>














<div class="docs container">

    <!-- Table of Contents -->
    <div class="hidden-xs hidden-sm col-md-4 col-lg-3 site-toc-container">
        <ul class="site-toc">
    

    <li>
        
            <span class="toc-section-heading">
                AGL Specifications
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/AGL_Specifications/agl_spec_v1.0_final.pdf">
                Automotive Grade Linux Requirements Specifications
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Security Blueprint
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/01-overview.html">
                Overview
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/02-adversaries.html">
                Adversaries
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/03-threat-analysis.htm">
                
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/04-security-concepts.html">
                Security Concepts
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/05-platform-security.html">
                Platform Security
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/06-application-security.html">
                Application Security
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="this-page" href="/docs/architecture/en/dev/reference/security/07-system-hardening.html">
                System Hardening
            </a>
            
                <span class="entry-highlight"></span>
            
        

        
        <div id="page-toc" class="page-toc"></div>

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Upgraded Security Blueprint 2017
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/README.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Part-1 Hardware
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-1/0_Abstract.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Part-2 Secure Boot
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-2/0_Abstract.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-2/1-Image.html">
                Image
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-2/2-Communication-modes.html">
                Communication modes
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-2/3-Consoles.html">
                Consoles
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Part-3 Hypervisor
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-3/0_Abstract.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Part-4 Kernel
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-4/0_Abstract.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-4/1-General.html">
                General
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-4/2-Memory.html">
                Memory
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-4/3-Consoles.html">
                Consoles
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-4/4-Debug.html">
                Debug
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-4/5-FileSystems.html">
                File Systems
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Part-5 Platform
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-5/0_Abstract.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-5/1-MAC.html">
                Mandatory Access Control
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-5/2-SystemD.html">
                SystemD
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-5/3-SystemBus.html">
                SystemBus
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-5/4-Services.html">
                System services and daemons
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-5/5-AppFw.html">
                Application Framework
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-5/6-Utilities.html">
                Utilities
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-5/7-Users.html">
                Users
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Part-6 Application
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-6/0_Abstract.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-6/1-Installation.html">
                Installation
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-6/2-PrivilegeManagement.html">
                Privilege management
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-6/3-Signature.html">
                Signature
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-6/4-Services.html">
                Services
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Part-7 Connectivity
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-7/0_Abstract.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-7/1-BusAndConnectors.html">
                Bus and connectors
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-7/2-Wireless.html">
                Wireless
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-7/3-Cloud.html">
                Cloud
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Part-8 Update
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-8/0_Abstract.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-8/1-FOTA.html">
                FOTA
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-8/2-SOTA.html">
                SOTA
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Part-9 Secure development
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/part-9/0_Abstract.html">
                Introduction
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Annexes
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/annexes/0_Abstract.html">
                Annexes
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/annexes/ConfigNotes.html">
                Config notes
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/annexes/todoNotes.html">
                Todo notes
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    
</ul>

        
    </li>
    
</ul>

    </div>

    <!-- Page content -->
    <div class="col-md-8 col-md-offset-4 col-lg-9 col-lg-offset-3 page-content-container container">
        <div class="page-content row">
            <div class="col-md-offset-1 col-md-10">
                <div class="content-header">

                    <!-- ToC Dropdown (for XS and SM sizes only) -->
                    <div class="toc-dropdown dropdown visible-xs-block visible-sm-block">
                        <button class="btn btn-default dropdown-toggle" type="button" id="tocDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            Table of Contents
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            






<li>
    <a class="" href="reference/AGL_Specifications/agl_spec_v1.0_final.pdf">
        Automotive Grade Linux Requirements Specifications
    </a>
</li>











<li>
    <a class="" href="reference/security/01-overview.html">
        Overview
    </a>
</li>




<li>
    <a class="" href="reference/security/02-adversaries.html">
        Adversaries
    </a>
</li>




<li>
    <a class="" href="reference/security/03-threat-analysis.htm">
        
    </a>
</li>




<li>
    <a class="" href="reference/security/04-security-concepts.html">
        Security Concepts
    </a>
</li>




<li>
    <a class="" href="reference/security/05-platform-security.html">
        Platform Security
    </a>
</li>




<li>
    <a class="" href="reference/security/06-application-security.html">
        Application Security
    </a>
</li>




<li>
    <a class="this-page" href="reference/security/07-system-hardening.html">
        System Hardening
    </a>
</li>











<li>
    <a class="" href="reference/security/README.html">
        Introduction
    </a>
</li>








<li>
    <a class="" href="reference/security/part-1/0_Abstract.html">
        Introduction
    </a>
</li>











<li>
    <a class="" href="reference/security/part-2/0_Abstract.html">
        Introduction
    </a>
</li>




<li>
    <a class="" href="reference/security/part-2/1-Image.html">
        Image
    </a>
</li>




<li>
    <a class="" href="reference/security/part-2/2-Communication-modes.html">
        Communication modes
    </a>
</li>




<li>
    <a class="" href="reference/security/part-2/3-Consoles.html">
        Consoles
    </a>
</li>











<li>
    <a class="" href="reference/security/part-3/0_Abstract.html">
        Introduction
    </a>
</li>











<li>
    <a class="" href="reference/security/part-4/0_Abstract.html">
        Introduction
    </a>
</li>




<li>
    <a class="" href="reference/security/part-4/1-General.html">
        General
    </a>
</li>




<li>
    <a class="" href="reference/security/part-4/2-Memory.html">
        Memory
    </a>
</li>




<li>
    <a class="" href="reference/security/part-4/3-Consoles.html">
        Consoles
    </a>
</li>




<li>
    <a class="" href="reference/security/part-4/4-Debug.html">
        Debug
    </a>
</li>




<li>
    <a class="" href="reference/security/part-4/5-FileSystems.html">
        File Systems
    </a>
</li>











<li>
    <a class="" href="reference/security/part-5/0_Abstract.html">
        Introduction
    </a>
</li>




<li>
    <a class="" href="reference/security/part-5/1-MAC.html">
        Mandatory Access Control
    </a>
</li>




<li>
    <a class="" href="reference/security/part-5/2-SystemD.html">
        SystemD
    </a>
</li>




<li>
    <a class="" href="reference/security/part-5/3-SystemBus.html">
        SystemBus
    </a>
</li>




<li>
    <a class="" href="reference/security/part-5/4-Services.html">
        System services and daemons
    </a>
</li>




<li>
    <a class="" href="reference/security/part-5/5-AppFw.html">
        Application Framework
    </a>
</li>




<li>
    <a class="" href="reference/security/part-5/6-Utilities.html">
        Utilities
    </a>
</li>




<li>
    <a class="" href="reference/security/part-5/7-Users.html">
        Users
    </a>
</li>











<li>
    <a class="" href="reference/security/part-6/0_Abstract.html">
        Introduction
    </a>
</li>




<li>
    <a class="" href="reference/security/part-6/1-Installation.html">
        Installation
    </a>
</li>




<li>
    <a class="" href="reference/security/part-6/2-PrivilegeManagement.html">
        Privilege management
    </a>
</li>




<li>
    <a class="" href="reference/security/part-6/3-Signature.html">
        Signature
    </a>
</li>




<li>
    <a class="" href="reference/security/part-6/4-Services.html">
        Services
    </a>
</li>











<li>
    <a class="" href="reference/security/part-7/0_Abstract.html">
        Introduction
    </a>
</li>




<li>
    <a class="" href="reference/security/part-7/1-BusAndConnectors.html">
        Bus and connectors
    </a>
</li>




<li>
    <a class="" href="reference/security/part-7/2-Wireless.html">
        Wireless
    </a>
</li>




<li>
    <a class="" href="reference/security/part-7/3-Cloud.html">
        Cloud
    </a>
</li>











<li>
    <a class="" href="reference/security/part-8/0_Abstract.html">
        Introduction
    </a>
</li>




<li>
    <a class="" href="reference/security/part-8/1-FOTA.html">
        FOTA
    </a>
</li>




<li>
    <a class="" href="reference/security/part-8/2-SOTA.html">
        SOTA
    </a>
</li>











<li>
    <a class="" href="reference/security/part-9/0_Abstract.html">
        Introduction
    </a>
</li>











<li>
    <a class="" href="reference/security/annexes/0_Abstract.html">
        Annexes
    </a>
</li>




<li>
    <a class="" href="reference/security/annexes/ConfigNotes.html">
        Config notes
    </a>
</li>




<li>
    <a class="" href="reference/security/annexes/todoNotes.html">
        Todo notes
    </a>
</li>










                        </ul>
                    </div>

                    <!--
                    
                    
                        <a class="edit" href="https://github.com/automotive-grade-linux/docs-agl/edit/master/docs/sec-blueprint/07-system-hardening.md"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit</a>

                    
                    
                    -->

                    <!-- Language dropdown -->
                    <!--
                    <div class="dropdown">
                        <button class="btn btn-default dropdown-toggle" type="button" id="languageDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            
                            <span class="caret"></span>
                        </button>

                        <!-- List all languages - ->
                        <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                            
                        </ul>
                    </div>
                    -->

                    <!-- Version dropdown -->
                    <!--
                    <div class="dropdown">
                        <button class="btn btn-default dropdown-toggle" type="button" id="versionDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            dev
                            
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="versionDropdown">

                            <!-- List versions available in this language - ->
                            
                        </ul>
                    </div>
                    -->
                </div>
                

                
                
                

                
                

                <!-- Show warnings for special versions -->
                <!-- dev warning
                
                    <div class="alert docs-alert alert-info" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        Draft version of documentation under development may change!
                        <a href="/docs/en/latest/">
                            Click here for the latest released version.
                        </a>
                    </div>
                
                -->

                <!-- outdated warning
                
                -->


                <div id="page-toc-source">
                    <!-- WARNING: This file is generated by fetch_docs.js using /w/workspace/sandbox-doc-update/webdocs-agl/content/tocs/architecture/fetched_files.yml -->

<p><strong>Table of Content</strong></p>

<ol id="markdown-toc">
  <li><a href="#scope" id="markdown-toc-scope">Scope</a></li>
  <li><a href="#limitations" id="markdown-toc-limitations">Limitations</a></li>
  <li><a href="#document-structure" id="markdown-toc-document-structure">Document Structure</a></li>
  <li><a href="#hardening" id="markdown-toc-hardening">Hardening</a></li>
  <li><a href="#secure-boot-software-flow-steps" id="markdown-toc-secure-boot-software-flow-steps">Secure Boot Software Flow Steps</a></li>
  <li><a href="#hardened-boot" id="markdown-toc-hardened-boot">Hardened Boot</a>    <ol>
      <li><a href="#boot-image-selection" id="markdown-toc-boot-image-selection">Boot image selection</a></li>
      <li><a href="#verifying-authenticity-of-booting-image" id="markdown-toc-verifying-authenticity-of-booting-image">Verifying Authenticity of booting image</a></li>
      <li><a href="#disable-usb-support" id="markdown-toc-disable-usb-support">Disable USB support</a></li>
      <li><a href="#console--remote-access" id="markdown-toc-console--remote-access">Console / Remote Access</a></li>
      <li><a href="#field-upgrades" id="markdown-toc-field-upgrades">Field upgrades</a></li>
      <li><a href="#disable-usb-serial-docsis-support" id="markdown-toc-disable-usb-serial-docsis-support">Disable USB, Serial, Docsis support</a></li>
      <li><a href="#immutable-environment-variables" id="markdown-toc-immutable-environment-variables">Immutable Environment variables</a></li>
    </ol>
  </li>
  <li><a href="#kernel-hardening" id="markdown-toc-kernel-hardening">Kernel Hardening</a>    <ol>
      <li><a href="#disable-the-serial-console" id="markdown-toc-disable-the-serial-console">Disable the serial console</a></li>
      <li><a href="#restrict-access-to-kernel-memory-through-device-file" id="markdown-toc-restrict-access-to-kernel-memory-through-device-file">Restrict access to kernel memory through device file</a></li>
      <li><a href="#bake-in-the-kernel-command-line" id="markdown-toc-bake-in-the-kernel-command-line">Bake-in the kernel command-line</a></li>
      <li><a href="#disable-kernel-debug-symbols" id="markdown-toc-disable-kernel-debug-symbols">Disable kernel debug symbols</a></li>
      <li><a href="#disable-access-to-a-kernel-core-dump" id="markdown-toc-disable-access-to-a-kernel-core-dump">Disable access to a kernel core dump</a></li>
      <li><a href="#disable-kgdb" id="markdown-toc-disable-kgdb">Disable KGDB</a></li>
      <li><a href="#disable-kprobes" id="markdown-toc-disable-kprobes">Disable Kprobes</a></li>
      <li><a href="#disable-tracing" id="markdown-toc-disable-tracing">Disable Tracing</a></li>
      <li><a href="#disable-profiling" id="markdown-toc-disable-profiling">Disable Profiling</a></li>
      <li><a href="#disable-magic-sysrq-support" id="markdown-toc-disable-magic-sysrq-support">Disable magic sysrq support</a></li>
      <li><a href="#disable-oops-print-on-bug" id="markdown-toc-disable-oops-print-on-bug">Disable OOPS print on BUG()</a></li>
      <li><a href="#disable-kexec" id="markdown-toc-disable-kexec">Disable kexec</a></li>
      <li><a href="#disable-kernel-ip-autoconfiguration" id="markdown-toc-disable-kernel-ip-autoconfiguration">Disable kernel IP autoconfiguration</a></li>
      <li><a href="#disable-procconfiggz" id="markdown-toc-disable-procconfiggz">Disable /proc/config.gz</a></li>
      <li><a href="#disable-swap" id="markdown-toc-disable-swap">Disable swap</a></li>
      <li><a href="#disable-nfs-file-system" id="markdown-toc-disable-nfs-file-system">Disable NFS file system</a></li>
      <li><a href="#disable-support-for-binary-formats-other-than-elf" id="markdown-toc-disable-support-for-binary-formats-other-than-elf">Disable support for binary formats other than ELF</a></li>
      <li><a href="#disable-load-all-symbols" id="markdown-toc-disable-load-all-symbols">Disable “Load All Symbols”</a></li>
      <li><a href="#disable-kernel-debugging" id="markdown-toc-disable-kernel-debugging">Disable Kernel Debugging</a></li>
      <li><a href="#disable-the-kernel-debug-filesystem" id="markdown-toc-disable-the-kernel-debug-filesystem">Disable the kernel debug filesystem</a></li>
      <li><a href="#disable-bug-support" id="markdown-toc-disable-bug-support">Disable BUG() support</a></li>
      <li><a href="#disable-sysctl-syscall-support" id="markdown-toc-disable-sysctl-syscall-support">Disable Sysctl syscall support</a></li>
      <li><a href="#kernel-modules" id="markdown-toc-kernel-modules">Kernel Modules</a></li>
      <li><a href="#disable-module-unloading" id="markdown-toc-disable-module-unloading">Disable module unloading</a></li>
      <li><a href="#disable-forced-module-loading" id="markdown-toc-disable-forced-module-loading">Disable Forced Module Loading</a></li>
      <li><a href="#the-mtd-utils-shall-not-be-present-on-the-file-system" id="markdown-toc-the-mtd-utils-shall-not-be-present-on-the-file-system">The mtd-utils shall not be present on the file system</a></li>
      <li><a href="#debuggers-shall-not-be-present-on-the-file-system" id="markdown-toc-debuggers-shall-not-be-present-on-the-file-system">Debuggers shall not be present on the file system</a></li>
      <li><a href="#partition-mount-options" id="markdown-toc-partition-mount-options">Partition Mount Options</a></li>
    </ol>
  </li>
  <li><a href="#hardened-boot-1" id="markdown-toc-hardened-boot-1">Hardened Boot</a>    <ol>
      <li><a href="#removal-of-memory-dump-commands" id="markdown-toc-removal-of-memory-dump-commands">Removal of memory dump commands</a></li>
      <li><a href="#disable-flash-access" id="markdown-toc-disable-flash-access">Disable flash access</a></li>
    </ol>
  </li>
  <li><a href="#hardened-system" id="markdown-toc-hardened-system">Hardened System</a>    <ol>
      <li><a href="#network" id="markdown-toc-network">Network</a></li>
      <li><a href="#remove-or-disable-unnecessary-services-ports-and-devices" id="markdown-toc-remove-or-disable-unnecessary-services-ports-and-devices">Remove or Disable Unnecessary Services, Ports, and Devices.</a></li>
      <li><a href="#restrict-usb-ports" id="markdown-toc-restrict-usb-ports">Restrict USB Ports</a></li>
    </ol>
  </li>
  <li><a href="#kernel-hardening-1" id="markdown-toc-kernel-hardening-1">Kernel Hardening</a>    <ol>
      <li><a href="#build-with-stack-protection" id="markdown-toc-build-with-stack-protection">Build with Stack Protection</a></li>
      <li><a href="#disable-access-to-devmem" id="markdown-toc-disable-access-to-devmem">Disable access to /dev/mem</a></li>
      <li><a href="#disable-cross-memory-attach" id="markdown-toc-disable-cross-memory-attach">Disable cross-memory attach</a></li>
      <li><a href="#disable-core-dumps" id="markdown-toc-disable-core-dumps">Disable core dumps</a></li>
      <li><a href="#disable-legacy-linux-support" id="markdown-toc-disable-legacy-linux-support">Disable Legacy Linux Support</a></li>
      <li><a href="#disable-firmware-auto-loading-user-mode-helper" id="markdown-toc-disable-firmware-auto-loading-user-mode-helper">Disable firmware auto-loading user mode helper</a></li>
      <li><a href="#enable-kernel-panic-on-oops" id="markdown-toc-enable-kernel-panic-on-oops">Enable Kernel Panic on OOPS</a></li>
      <li><a href="#disable-socket-monitoring-interface" id="markdown-toc-disable-socket-monitoring-interface">Disable socket monitoring interface</a></li>
      <li><a href="#disable-bpf-jit" id="markdown-toc-disable-bpf-jit">Disable BPF JIT</a></li>
      <li><a href="#enable-enforced-module-signing" id="markdown-toc-enable-enforced-module-signing">Enable Enforced Module Signing</a></li>
      <li><a href="#disable-all-usb-pcmcia-and-other-hotplug-bus-drivers-that-arent-needed" id="markdown-toc-disable-all-usb-pcmcia-and-other-hotplug-bus-drivers-that-arent-needed">Disable all USB, PCMCIA (and other hotplug bus) drivers that aren’t needed</a></li>
      <li><a href="#disable-all-file-systems-not-needed" id="markdown-toc-disable-all-file-systems-not-needed">Disable all file systems not needed</a></li>
      <li><a href="#kernel-address-display-restriction" id="markdown-toc-kernel-address-display-restriction">Kernel Address Display Restriction</a></li>
      <li><a href="#dmesg-restrictions" id="markdown-toc-dmesg-restrictions">DMESG Restrictions</a></li>
      <li><a href="#stack-smashing-attacks" id="markdown-toc-stack-smashing-attacks">Stack Smashing Attacks</a></li>
      <li><a href="#position-independent-executables" id="markdown-toc-position-independent-executables">Position Independent Executables</a></li>
      <li><a href="#detect-buffer-overflows" id="markdown-toc-detect-buffer-overflows">Detect Buffer Overflows</a></li>
      <li><a href="#prevent-overwrite-attacks" id="markdown-toc-prevent-overwrite-attacks">Prevent Overwrite Attacks</a></li>
      <li><a href="#library-linking" id="markdown-toc-library-linking">Library linking</a></li>
    </ol>
  </li>
  <li><a href="#removal-or-non-inclusion-of-utilities" id="markdown-toc-removal-or-non-inclusion-of-utilities">Removal or Non-Inclusion of Utilities</a></li>
  <li><a href="#root-access" id="markdown-toc-root-access">Root Access</a></li>
  <li><a href="#network-hardening" id="markdown-toc-network-hardening">Network Hardening</a>    <ol>
      <li><a href="#disable-ipv4-forwarding" id="markdown-toc-disable-ipv4-forwarding">Disable IPv4 Forwarding</a></li>
      <li><a href="#disable-ip-source-routing" id="markdown-toc-disable-ip-source-routing">Disable IP Source Routing</a></li>
      <li><a href="#disable-icmp" id="markdown-toc-disable-icmp">Disable ICMP</a></li>
      <li><a href="#ignore-all-broadcast-message" id="markdown-toc-ignore-all-broadcast-message">Ignore all broadcast message</a></li>
      <li><a href="#disable-ipv6" id="markdown-toc-disable-ipv6">Disable IPV6</a></li>
      <li><a href="#enable-tcp-syn-cookie-protection" id="markdown-toc-enable-tcp-syn-cookie-protection">Enable TCP SYN Cookie Protection</a></li>
    </ol>
  </li>
  <li><a href="#hardened-system-1" id="markdown-toc-hardened-system-1">Hardened System</a>    <ol>
      <li><a href="#image-security-analysis-framework-isafw" id="markdown-toc-image-security-analysis-framework-isafw">Image Security Analysis Framework (ISAFW)</a></li>
      <li><a href="#usage" id="markdown-toc-usage">Usage</a></li>
    </ol>
  </li>
</ol>

<h1 id="overview">Overview</h1>

<h2 id="scope">Scope</h2>

<p>This document provides recommended guidelines for adding protection to an
embedded system. The information contained in this document is applicable
to systems based on Automotive Grade Linux.</p>

<h2 id="limitations">Limitations</h2>

<ul>
  <li>
    <p>This document is based on knowledge and research gained from looking
at security desktop and server versions of Linux as well as Android
exploits and hardening.</p>
  </li>
  <li>
    <p>Some kernel configuration options can have an impact on performance.<br />
This will be noted where applicable.­</p>
  </li>
</ul>

<h2 id="document-structure">Document Structure</h2>

<p>This document has been divided into three sections; REQUIREMENTS,
RECOMMENDATIONS, and VALIDATION. The REQUIREMENTS section details
explicit requirements that must be adhered to for the embedded
device.<br />
The RECOMMENDATIONS section details best practices, and some
recommended security settings for the embedded device. <br />
The third section, VALIDATION, provides reference scripts and test procedures that
can be used to verify adherence with the REQUIREMENTS detailed in the
first section of this guide.</p>

<h2 id="hardening">Hardening</h2>

<p>The term <em>Hardening</em> refers to the tools, techniques and processes
required in order to reduce the attack surface on an embedded system,
such as an embedded control unit (ECU) or other managed device.<br />
The target for all hardening activities is to prevent the execution of
invalid binaries on the device, and to prevent copying of security
related data from the device.<br />
There are three main areas of focus for hardening an embedded device:</p>

<p><strong>Boot Hardening</strong>: Steps/requirements to configure the boot sequence,
in order to restrict the device from executing anything other than the
approved software image.</p>

<p><strong>System Hardening</strong>: Best practices associated with the configuration
of an embedded Linux based operating system. This section includes both
hardening of the kernel itself, as well as specific configurations and
patches used to protect against known vulnerabilities within the build
and configuration of the root filesystem.</p>

<p><strong>Application Hardening:</strong> Best practices to apply to the build and
release of user space applications, in order to reduce the number of
attack surfaces used by potential attackers.</p>

<h2 id="secure-boot-software-flow-steps">Secure Boot Software Flow Steps</h2>

<ol>
  <li>
    <p>After power on, the processor will perform the verification
of the Stage 1 boot image, the stage 2 boot image and the Secure
loader image.</p>

    <p>a.  If any of the images fail the verification process the device
    will not boot.</p>
  </li>
  <li>
    <p>Upon successful verification of all of the boot and loader images,
the secure process will initiate the Stage 1 boot process.</p>
  </li>
  <li>
    <p>The Stage 1 boot process will perform processor initialization, and
then initiate the Stage 2 boot process.</p>
  </li>
  <li>
    <p>The Stage 2 boot process will initiate the Secure Loader, which will
process any customer specific customizations (e.g. front panel
of ECU, USB based image updates, etc).</p>
  </li>
  <li>
    <p>The Secure Loader will check to determine if there are any updates
to be processed. If the update settings indicate that an upgrade
should occur then the Secure Loader will will determine the correct
action based on the nature of the upgrades:</p>

    <p>a.  If the Secure Loader determines that an upgrade was performed
    (or attempted), it will initiate the reboot process.</p>

    <p>b.  If no upgrades were processed: then the Secure Loader will pass
    control back to the Stage 2 boot process for further processing</p>
  </li>
  <li>
    <p>The Stage 2 boot process will continue with the boot process, by
performing a verification of the kernel image prior to the load of
that image</p>

    <p>a.  If the kernel image verification fails, the Stage 2 boot loader
    will not boot</p>
  </li>
  <li>
    <p>The Stage 2 boot loader will load the successfully verified kernel
and boot the linux OS</p>
  </li>
  <li>
    <p>The booted Linux OS will perform the normal Linux init sequence</p>
  </li>
  <li>
    <p>The Linux init process will start the required applications and
services as described in the init process and present on the rootfs.</p>
  </li>
</ol>

<h1 id="requirements">Requirements</h1>

<p>For the purposes of reference and explanation, we are providing guidance
  on how to configure an embedded device that runs with a 3.10.17
  Linux kernel, and includes the use of U-Boot as the <em>Stage 2</em>
  These requirements must still be met by manufacturers that
  opt to build using an alternative version of the Linux kernel.</p>

<h2 id="hardened-boot">Hardened Boot</h2>

<h3 id="boot-image-selection">Boot image selection</h3>

<p>The boot process shall be uninterruptable and shall irrevocably boot the
image as specified in the boot environment.</p>

<p>In U-Boot set the “<strong>bootdelay</strong>” environment variable and/or define
CONFIG_BOOTDELAY to -2.</p>

<h3 id="verifying-authenticity-of-booting-image">Verifying Authenticity of booting image</h3>

<p>It shall not be possible to boot from an unverified image.</p>

<p>The secure boot feature in U-Boot shall be enabled. The secure boot
feature is available from U-Boot 2013.07 version.</p>

<p>To enable the secure boot feature, enable the following features:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CONFIG_FIT: enables support for Flat Image Tree (FIT) uImage format.
CONFIG_FIT_SIGNATURE: enables signature verification of FIT images.
CONFIG_RSA: enables RSA algorithm used for FIT image verifitcation.
CONFIG_OF_CONTROL: enables Flattened Device Tree (FDT) configuration.
CONFIG_OF_SEPARATE: enables separate build of u-Boot from the device tree.
CONFIG_DEFAULT_DEVICE_TREE: specifies the default Device Tree used for the
run-time configuration of U-Boot.
</code></pre>
</div>

<p>Generate the U-Boot image with public keys to validate and load the
image. It shall use RSA2048 and SHA256 for authentication.</p>

<h3 id="disable-usb-support">Disable USB support</h3>

<p>To disable USB support in U-Boot, following configs shall not be
defined:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CONFIG_CMD_USB: enables basic USB support and the usb command
CONFIG_USB_UHCI: defines the lowlevel part.
CONFIG_USB_KEYBOARD: enables the USB Keyboard
CONFIG_USB_STORAGE: enables the USB storage devices
CONFIG_USB_HOST_ETHER: enables USB ethernet adapter support
</code></pre>
</div>

<h3 id="console--remote-access">Console / Remote Access</h3>

<p>Serial console output shall be disabled. To disable console output in
U-Boot, set the following macros:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CONFIG_SILENT_CONSOLE
CONFIG_SYS_DEVICE_NULLDEV
CONFIG_SILENT_CONSOLE_UPDATE_ON_RELOC
</code></pre>
</div>

<p>and set “<strong><em>silent”</em></strong> environment variable.</p>

<p>For the Secure loader, disable the traces by undefining the below macro</p>

<div class="highlighter-rouge"><pre class="highlight"><code>INC_DEBUG_PRINT
</code></pre>
</div>

<p>For sboot proper configuration needs to be done to disable the serial
console.</p>

<h3 id="field-upgrades">Field upgrades</h3>

<p>Field upgrades can be achieved securely by using a Secure Loader.
This loader will authenticate an incoming image (USB,Serial, Network)
prior to writing it to the flash memory on the device. It should not be
possible to write to flash from bootloader (U-Boot). Note that because
 USB support is to be disabled within the sboot/U-Boot code, the board
specific implementation of the Secure Loader will have to manage the
entire USB initialization, enumeration, and read/write access to the
mass storage device.</p>

<h3 id="disable-usb-serial-docsis-support">Disable USB, Serial, Docsis support</h3>

<p>Disable USB support in sboot. In addition, disable unnecessary communication
modes like Ethernet, Serial ports, DOCSIS in U-Boot and sboot that are
not necessary.</p>

<h3 id="immutable-environment-variables">Immutable Environment variables</h3>

<p>In U-Boot, ensure Kernel command line, boot commands, boot delay and
other environment variables are immutable. This will prevent
side-loading of alternate images, by restricting the boot selection to
only the image in FLASH.</p>

<p>The environment variables shall be part of text region in U-Boot as
default environment variable and not in non-volatile memory.</p>

<p>Remove configuration options related to non-volatile memory such as:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#define CONFIG_ENV_IS_IN_MMC
#define CONFIG_ENV_IS_IN_EEPROM
#define CONFIG_ENV_IS_IN_FLASH
#define CONFIG_ENV_IS_IN_DATAFLASH
#define CONFIG_ENV_IS_IN_MMC
#define CONFIG_ENV_IS_IN_FAT
#define CONFIG_ENV_IS_IN_NAND
#define CONFIG_ENV_IS_IN_NVRAM
#define CONFIG_ENV_IS_IN_ONENAND
#define CONFIG_ENV_IS_IN_SPI_FLASH
#define CONFIG_ENV_IS_IN_REMOTE
#define CONFIG_ENV_IS_IN_UBI
</code></pre>
</div>

<p>and include the following definition:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#define** CONFIG_ENV_IS_NOWHERE
</code></pre>
</div>

<h2 id="kernel-hardening">Kernel Hardening</h2>

<p>The following sub-sections contain information on various kernel
  configuration options to enhance the security measures in the kernel
  and also for applications compiled to take advantage of these security
  features.<br />
  Additionally, there are also configuration options that
  close known vulnerable configuration options.<br />
  Here’s a high level summary of various kernel configurations that 
  shall be required for deployment.</p>

<h3 id="disable-the-serial-console">Disable the serial console</h3>

<p>The serial console should be disabled to prevent an attacker from
  accessing this powerful interface.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_SERIAL_8250</span><span class="o">=</span>n
  <span class="nv">CONFIG_SERIAL_8250_CONSOLE</span><span class="o">=</span>n
  <span class="nv">CONFIG_SERIAL_CORE</span><span class="o">=</span>n
  <span class="nv">CONFIG_SERIAL_CORE_CONSOLE</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="restrict-access-to-kernel-memory-through-device-file">Restrict access to kernel memory through device file</h3>

<p>The /dev/kmem file in Linux systems is directly mapped to kernel
  virtual memory.<br />
  This can be disastrous if an attacker gains root
  access, as the attacker would have direct access to kernel virtual
  memory.</p>

<p>To disable the /dev/kmem file, which is very infrequently used by
  applications, the following kernel option should be set in the
  compile-time kernel configuration:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  CONFIG_DEVKMEM=n
</code></pre>
</div>

<p>In case applications in userspace need /dev/kmem support, it should be
  available only for authenticated applications.</p>

<h3 id="bake-in-the-kernel-command-line">Bake-in the kernel command-line</h3>

<p>The kernel command-line is used to control many aspects of the booting
  kernel, and is prone to tampering as they are passed in RAM with
  little to no reverse validation on these parameters.<br />
  To prevent this type of attack, the kernel shall be configured to ignore command line
  arguments, and use pre-configured (compile time) options instead.</p>

<p>Set the kernel command line in the CONFIG_CMDLINE KConfig item and
  then pass no arguments from the bootloader.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_CMDLINE_BOOL</span><span class="o">=</span>y
  <span class="nv">CONFIG_CMDLINE</span><span class="o">=</span>”insert kernel <span class="nb">command </span>line here”
  <span class="nv">CONFIG_CMDLINE_OVERRIDE</span><span class="o">=</span>y
</code></pre>
</div>

<p>It is recommended that any per-device settings (eg. MAC addresses,
  serial numbers, etc.) be stored and accessed from read-only memory (or
  files), and that any such parameters be verified (signature checking)
  prior to their use.</p>

<h3 id="disable-kernel-debug-symbols">Disable kernel debug symbols</h3>

<p>Debug symbols should always be removed from production kernels as they
  provide a lot of information to attackers.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEBUG_INFO</span><span class="o">=</span>n
</code></pre>
</div>

<p>These kernel debug symbols are enabled by other config items in the
  kernel.<br />
  Care should be taken to disable those also.<br />
  If CONFIG_DEBUG_INFO cannot be disabled then enabling
  CONFIG_DEBUG_INFO_REDUCED is second best.</p>

<h3 id="disable-access-to-a-kernel-core-dump">Disable access to a kernel core dump</h3>

<p>This kernel configuration disables access to a kernel core dump from
  user space – if enabled it gives attackers a useful view into kernel
  memory.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_PROC_KCORE</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kgdb">Disable KGDB</h3>

<p>The Linux kernel supports KGDB over USB and console ports. These
  mechanisms are controlled by the kgdbdbgp and kgdboc kernel
  command-line parameters.<br />
  It is important to ensure that no shipping
  product contains a kernel with KGDB compiled-in.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_KGDB</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kprobes">Disable Kprobes</h3>

<p>Kprobes enables you to dynamically break into any kernel routine and
  collect debugging and performance information non-disruptively.<br />
  You can trap at almost any kernel code address, specifying a handler
  routine to be invoked when the breakpoint is hit.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_KPROBES</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-tracing">Disable Tracing</h3>

<p>FTrace enables the kernel to trace every kernel function.<br />
  Providing kernel trace functionality would assist an attacker in discovering attack vectors.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_FTRACE</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-profiling">Disable Profiling</h3>

<p>Profiling and OProfile enables profiling the whole system, include the kernel,
  kernel modules, libraries, and applications.<br />
  Providing profiling functionality
  would assist an attacker in discovering attack vectors.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_OPROFILE</span><span class="o">=</span>n
  <span class="nv">CONFIG_PROFILING</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-magic-sysrq-support">Disable magic sysrq support</h3>

<p>On a few architectures, you can access a powerful debugger interface
  from the keyboard.<br />
  The same powerful interface can be present on the serial console 
  – responding to serial break – of Linux on other architectures.<br />
  Disable to avoid potentially exposing this powerful backdoor.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_MAGIC_SYSRQ</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-oops-print-on-bug">Disable OOPS print on BUG()</h3>

<p>The output from OOPS print can be helpful in Return Oriented
  Programming (ROP) when trying to determine the effectiveness of an
  exploit.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEBUG_BUGVERBOSE</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kexec">Disable kexec</h3>

<p>This prevents someone who gets root from supplanting the kernel.<br />
  This can be used as a way to bypass signed kernels.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_KEXEC</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kernel-ip-autoconfiguration">Disable kernel IP autoconfiguration</h3>

<p>It is preferable to have IP configuration performed using a user-space
  tool as these tend to have more validation.<br />
  We do not want the network
  interface coming up until the system has come up properly.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_IP_PNP</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-procconfiggz">Disable /proc/config.gz</h3>

<p>It is extremely important to not expose the kernel configuration used
  on a production device to a potential attacker.<br />
  With access to the
  kernel config, it could be possible for an attacker to build a custom
  kernel for the device that may disable critical security features.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_IKCONFIG</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-swap">Disable swap</h3>

<p>If not disabled, attackers can enable swap at runtime, add pressure to
  the memory subsystem and then scour the pages written to swap for
  useful information.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_SWAP</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-nfs-file-system">Disable NFS file system</h3>

<p>While often enabled in development, when left enabled in production
  builds this can be a very useful way for an attacker to get files onto
  and off of an STB.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_NFSD</span><span class="o">=</span>n
  <span class="nv">CONFIG_NFS_FS</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-support-for-binary-formats-other-than-elf">Disable support for binary formats other than ELF</h3>

<p>This will make possible to plug wrapper-driven binary formats into
  the kernel.<br />
  It enables support for binary formats other than ELF.<br />
  Providing the ability to use alternate interpreters would assist an attacker in
  discovering attack vectors</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_BINFMT_MISC</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-load-all-symbols">Disable “Load All Symbols”</h3>

<p>There is a /proc/kallsyms file which exposes the kernel memory space
  address of many kernel symbols (functions, variables, etc.).<br />
  This information is useful to attackers in identifying kernel
  versions/configurations and in preparing payloads for exploits of
  kernel space.</p>

<p>Both KALLSYMS_ALL and KALLSYMS shall be disabled;</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_KALLSYMS</span><span class="o">=</span>n
  <span class="nv">CONFIG_KALLSYMS_ALL</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kernel-debugging">Disable Kernel Debugging</h3>

<p>There are development-only branches of code in the kernel enabled by
  the DEBUG_KERNEL conf.<br />
  This should be disabled to compile-out these branches.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEBUG_KERNEL</span><span class="o">=</span>n
</code></pre>
</div>

<p>In some kernel versions, disabling this requires also disabling
  CONFIG_EMBEDDED, and CONFIG_EXPERT Disabling CONFIG_EXPERT makes it
  impossible to disable _COREDUMP, DEBUG_BUGVERBOSE, _NAMESPACES,
  _KALLSYMS and _BUG.<br />
  In which case it is better to leave this enabled
  than enable the others.</p>

<h3 id="disable-the-kernel-debug-filesystem">Disable the kernel debug filesystem</h3>

<p>The kernel debug filesystem presents a lot of useful information and
  means of manipulation of the kernel to an attacker.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEBUG_FS</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-bug-support">Disable BUG() support</h3>

<p>The kernel will display backtrace and register information for BUGs
  and WARNs in kernel space, making it easier for attackers to develop
  exploits.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_BUG</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-sysctl-syscall-support">Disable Sysctl syscall support</h3>

<p>Enabling this will result in code being included that is hard to
  maintain and not well tested.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_SYSCTL_SYSCALL</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="kernel-modules">Kernel Modules</h3>

<h3 id="disable-module-unloading">Disable module unloading</h3>

<p>This stops an attacker unloading security focused kernel modules.<br />
  It will also prevent the attacker from removing evidence of any attempted
  kernel tampering that may have been initiated by loading of a kernel
  module.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_MODULE_UNLOAD</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-forced-module-loading">Disable Forced Module Loading</h3>

<p>If enabled, then modules without version information or with
  mismatched version information may be forcibly loaded into the kernel.<br />
  Disabling this configuration forces the attackers to build modules
  with matched kernel sources and configuration in order to load them.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_MODULE_FORCE_LOAD</span><span class="o">=</span>n
</code></pre>
</div>
<p>### System Services</p>

<h4 id="console--remote-access-1">Console &amp; Remote Access</h4>

<ul>
  <li>
    <p>The kernel console interfaces shall be disabled. Do not pass any statements
of the following kind (e.g. console=ttyS0 console=tty0) on the kernel
command line. All of the console=&lt;interface&gt; statements should be
stripped and removed from the kernel command line.</p>
  </li>
  <li>
    <p>The telnet server shall be disabled.</p>
  </li>
  <li>
    <p>Do not start telnetd in init scripts.</p>
  </li>
  <li>
    <p>Remove telnetd from the root file system.</p>
  </li>
  <li>
    <p>Root login access via the console shall be disabled.</p>
  </li>
  <li>
    <p>Do not run shell or getty on /dev/ttySx or /dev/console from
init scripts.</p>
  </li>
  <li>
    <p>Root login access through remote access such as SSH shall
be disabled or completely removed</p>
  </li>
</ul>

<h4 id="disable-sudo-for-other-users">Disable <em>sudo</em> for other users</h4>

<p>Remove the /etc/sudoers file from the root file system</p>

<p>Remove the sudo command from the root file system.</p>

<h4 id="mount-tmp-file-system-as-noexec">Mount /tmp file system as noexec</h4>

<p>A lot of malware can be stopped by not allowing files located in /tmp
  to execute.</p>

<p>The /etc/fstab file should contain a line for the /tmp directory with
  the noexec mount option set as follows:</p>

<p>tmpfs /tmp tmpfs noexec 0 0</p>

<h4 id="user-account-management">User Account Management</h4>

<p>All user accounts shall have strong, non-default passwords. A strong
  password is described to have all of the following attributes:</p>

<ul>
  <li>
    <p>At least one upper-case letter</p>
  </li>
  <li>
    <p>At least one numeric character</p>
  </li>
  <li>
    <p>At least one lower-case letter</p>
  </li>
  <li>
    <p>Password shall be eight or more characters in length</p>
  </li>
  <li>
    <p>Shall not use a known, common pattern (e.g. Xxxxxxx#
or Xxxxxxx##)</p>
  </li>
</ul>

<h4 id="remove-known-insecure-services">Remove known insecure services</h4>

<p>The following legacy services are inherently insecure and should be
  avoided:</p>

<ul>
  <li>
    <p>rlogind</p>
  </li>
  <li>
    <p>rshd</p>
  </li>
  <li>
    <p>rcmd</p>
  </li>
  <li>
    <p>rexecd</p>
  </li>
  <li>
    <p>rbootd</p>
  </li>
  <li>
    <p>rquotad</p>
  </li>
  <li>
    <p>rstatd</p>
  </li>
  <li>
    <p>rusersd</p>
  </li>
  <li>
    <p>rwalld</p>
  </li>
  <li>
    <p>rhosts</p>
  </li>
  <li>
    <p>rexd</p>
  </li>
</ul>

<p>These services offer insufficient authentication, no encryption, and
  are not considered secure. They shall be removed along with their
  configuration files.</p>

<h3 id="the-mtd-utils-shall-not-be-present-on-the-file-system">The mtd-utils shall not be present on the file system</h3>

<p>The mtd-utils binary package (also known as the Memory Technology
  Device Utilities package) contains a collection of executable binaries
  that allow a user to perform operations on raw flash devices. Here’s a
  non-exhaustive sample of commonly used utilities that are part of the
  mtd-utils package:</p>

<ul>
  <li>
    <p>flash_erase</p>
  </li>
  <li>
    <p>flash_eraseall</p>
  </li>
  <li>
    <p>flashcp</p>
  </li>
  <li>
    <p>flash_lock</p>
  </li>
  <li>
    <p>flash_otp_dump</p>
  </li>
  <li>
    <p>flash_otp_info</p>
  </li>
  <li>
    <p>flash_unlock</p>
  </li>
  <li>
    <p>mkfs.jffs2</p>
  </li>
  <li>
    <p>mkfs.ubifs</p>
  </li>
  <li>
    <p>nanddump</p>
  </li>
  <li>
    <p>nandtest</p>
  </li>
  <li>
    <p>nandwrite</p>
  </li>
  <li>
    <p>ubiattach</p>
  </li>
  <li>
    <p>ubicrc32</p>
  </li>
  <li>
    <p>ubidetach</p>
  </li>
  <li>
    <p>ubiformat</p>
  </li>
  <li>
    <p>ubimkvol</p>
  </li>
  <li>
    <p>ubinfo</p>
  </li>
  <li>
    <p>ubinize</p>
  </li>
  <li>
    <p>ubirename</p>
  </li>
  <li>
    <p>ubirmvol</p>
  </li>
  <li>
    <p>ubirsvol</p>
  </li>
  <li>
    <p>ubiupdatevol</p>
  </li>
</ul>

<p>The mtd-utils package as a whole (including all of its executable
  binaries) shall not be present on the file system. Including these
  binaries on the file system will facilitate an attacker’s ability to
  read, write or otherwise gather information about raw flash devices
  present on the system.</p>

<h3 id="debuggers-shall-not-be-present-on-the-file-system">Debuggers shall not be present on the file system</h3>

<p>No debuggers shall be present on the file system. This includes, but
  is not limited to, the GNU Debugger client/server (commonly known in
  their short form names such as the gdb and gdbserver executable
  binaries respectively), or the LLDB next generation debugger.
  Including these binaries as part of the file system will facilitate an
  attacker’s ability to reverse engineer and debug (either locally or
  remotely) any process that is currently executing on the device.</p>

<h3 id="partition-mount-options">Partition Mount Options</h3>

<p>There are several security restrictions that can be set on a
  filesystem when it is mounted. Some common security options include,
  but are not limited to:</p>

<p>nosuid - Do not allow set-user-identifier or set-group-identifier bits
  to take effect</p>

<p>nodev - Do not interpret character or block special devices on the
  filesystem</p>

<p>noexec - Do not allow execution of any binaries on the mounted
  filesystem</p>

<p>ro - Mount filesystem as read-only</p>

<p>The following flags shall be used for mounting common filesystems:</p>

<table>
  <thead>
    <tr>
      <th>Partition</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/boot</td>
      <td>Use nosuid and nodev and consider using noexec.</td>
    </tr>
    <tr>
      <td>/var &amp; /tmp</td>
      <td>In the /etc/fstab or vfstab file, add nosuid, nodev and noexec.</td>
    </tr>
    <tr>
      <td>Non-Root local partitions</td>
      <td>If the filesystem type is ext2 or ext3 and the mount point is not ‘/’, add the nodev option.</td>
    </tr>
    <tr>
      <td>Removable storage partitions</td>
      <td>Add nodev, nosuid, and noexec options.</td>
    </tr>
    <tr>
      <td>Temporary storage partitions</td>
      <td>Add nodev, nosuid, and noexec options.</td>
    </tr>
    <tr>
      <td>/dev/shm</td>
      <td>Add nodev, nosuid, and noexec options.</td>
    </tr>
    <tr>
      <td>/dev</td>
      <td>Add nosuid, noexec options.\</td>
    </tr>
    <tr>
      <td> </td>
      <td>Note: if CONFIG_DEVTMPFS_MOUNT is set then the kernel will mount /dev and will not apply</td>
    </tr>
    <tr>
      <td> </td>
      <td>the nosuid, noexec options. Either disable CONFIG_DEVTMPFS_MOUNT or add a remount with</td>
    </tr>
    <tr>
      <td> </td>
      <td>noexec and nosuid options to system startup.</td>
    </tr>
  </tbody>
</table>

<h1 id="recommendations">Recommendations</h1>

<p>The following sections detail best practices that should be applied in
order to secure a device.<br />
Although they are not currently listed as hard
requirements, they may be upgraded to requirements status in the future.
In addition, specific operators may change some of these recommendations
into requirements based on their specific needs and objectives.</p>

<h2 id="hardened-boot-1">Hardened Boot</h2>

<p>The boot loader consists of the Primary boot loader residing in OTP
memory, sboot, U-Boot and Secure loader residing in external flash (NAND
or SPI/NOR flash memory). The CPU on power on or reset executes the
primary boot loader. The OTP primary boot loader makes the necessary
initial system configuration and then loads the secondary boot loader
sboot from external flash memory to ram memory. The sboot then loads the
U-Boot along with the Secure loader. U-Boot then verifies and loads the
Kernel/system image before passing control to it.</p>

<h3 id="removal-of-memory-dump-commands">Removal of memory dump commands</h3>

<p>In U-Boot, following commands shall be disabled to avoid memory dumps</p>

<div class="highlighter-rouge"><pre class="highlight"><code>md : Memory Display command

mm : Memory modify command – auto incrementing address

nm : Memory modify command – constant address

mw : memory write

cp : memory copy

mwc : memory write cyclic

mdc : memory display cyclic

mtest : simple ram read/write test

loopw : infinite write loop on address range
</code></pre>
</div>

<p>Similarly memory dump support shall be disabled from sboot</p>

<h3 id="disable-flash-access">Disable flash access</h3>

<p>In U-Boot following flash memory commands shall be disabled:</p>

<p>Nand: Support for nand flash access available through <strong>do_nand</strong> has
to be disabled.</p>

<p>Similarly sboot should disable flash access support through command line
if any.</p>

<h2 id="hardened-system">Hardened System</h2>

<h3 id="network">Network</h3>

<h4 id="disable-all-network-interfaces">Disable all Network Interfaces</h4>

<p>Preferably no network interface is allowed, but if required, then the
  enabled services should be restricted to only those described in the
  STB’s functional description.</p>

<h3 id="remove-or-disable-unnecessary-services-ports-and-devices">Remove or Disable Unnecessary Services, Ports, and Devices.</h3>

<p>Services and utilities that do not have a defined purpose on a system
  should be removed. If removal is not possible, but the service or
  utility can be disabled, then it should be disabled. If a service or
  utility is necessary, available secure configuration best practices
  should be implemented.</p>

<p>Telnet, FTP, and NFS have security weaknesses that are well known;
  however, customers may have requirements to use these services. If
  remote shell access and file transfer are required, then provide more
  secure options, such as SSH and SFTP/SCP.</p>

<h3 id="restrict-usb-ports">Restrict USB Ports</h3>

<p>Linux Kernel support for USB should be compiled-out if not required.
  If it is needed, the Linux Kernel should be configured to only enable
  the minimum required USB devices.</p>

<p>User-initiated USB-filesystems should be treated with special care..</p>

<p>Whether or not the filesystems are mounted in userspace(FUSE), restricted
  mount options should be observed.</p>

<h2 id="kernel-hardening-1">Kernel Hardening</h2>

<p>The following sub-sections contain information on various kernel
  configuration options that will require updating to a newer kernel
  version in order to enhance the security measures in the kernel and
  also for applications compiled to take advantage of these security
  features.</p>

<p>Additionally, there are also configuration options that close known
  vulnerable configuration options.<br />
  Here’s a high level summary of the
  various kernel configurations and which kernel version they pertain:</p>

<table>
  <thead>
    <tr>
      <th>Kernel Configuration</th>
      <th>Kernel Version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CONFIG_UNIX_DIAG=n</td>
      <td>3.3+</td>
    </tr>
    <tr>
      <td>CROSS_MEMORY_ATTACH=n</td>
      <td>3.5+</td>
    </tr>
    <tr>
      <td>CONFIG_PANIC_ON_OOPS=y</td>
      <td>3.5+</td>
    </tr>
    <tr>
      <td>CONFIG_COREDUMP=n</td>
      <td>3.7+</td>
    </tr>
    <tr>
      <td>CONFIG_MODULE_SIG_FORCE=y</td>
      <td>3.7+</td>
    </tr>
    <tr>
      <td>CONFIG_PACKET_DIAG=n</td>
      <td>3.7+</td>
    </tr>
    <tr>
      <td>CONFIG_FW_LOADER_USER_HELPER=n</td>
      <td>3.9+</td>
    </tr>
    <tr>
      <td>CONFIG_CC_STACKPROTECTOR=y</td>
      <td>3.11+</td>
    </tr>
    <tr>
      <td>CONFIG_USELIB=n</td>
      <td>3.15+</td>
    </tr>
    <tr>
      <td>BPF_JIT=n</td>
      <td>3.16+</td>
    </tr>
    <tr>
      <td>CONFIG_DEVMEM=n</td>
      <td>4.0+</td>
    </tr>
  </tbody>
</table>

<h3 id="build-with-stack-protection">Build with Stack Protection</h3>

<p>Similar to the stack protector used for ELF programs in user-space,
  the kernel can protect its internal stacks as well.<br />
  This configuration is supported in Linux 3.11 and greater and
  thus should only be enabled for such versions.<br />
  This configuration also
  requires building the kernel with the gcc compiler 4.2 or greater.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_CC_STACKPROTECTOR</span><span class="o">=</span>y
</code></pre>
</div>

<h3 id="disable-access-to-devmem">Disable access to /dev/mem</h3>

<p>The /dev/mem file in Linux systems is directly mapped to physical
  memory.<br />
  This can be disastrous if an attacker gains root access, as
  the attacker would have direct access to physical memory through this
  convenient device file.<br />
  It may not always be possible to disable such
  file, as some applications might need such support.<br />
  In that case then
  this device file should be available only for authenticated
  applications.<br />
  This configuration is supported in Linux 4.0 and greater
  and thus should only be disabled for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEVMEM</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-cross-memory-attach">Disable cross-memory attach</h3>

<p>Disable the process_vm_*v syscalls which allow one process to
  peek/poke the virtual memory of another.<br />
  This configuration is
  supported in Linux 3.5 and greater and thus should only be disabled
  for such versions.
<code class="highlighter-rouge">bash
  CROSS_MEMORY_ATTACH=n
</code></p>

<h3 id="disable-core-dumps">Disable core dumps</h3>

<p>Core dumps provide lot of debug information for hackers.<br />
  So disabling core dumps is recommended in production builds.<br />
  This configuration is
  supported in Linux 3.7 and greater and thus should only be disabled
  for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_COREDUMP</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-legacy-linux-support">Disable Legacy Linux Support</h3>

<p>There are some Kernel Configs which are present only to support legacy
  binaries.<br />
  See also section 2.2.2.18 for disabling support for legacy binary formats.<br />
  The uselib system call, in particular, has no valid use in any libc6 or uclibc system in recent times.<br />
  This configuration is supported in Linux 3.15 and greater and thus should only be
  disabled for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_USELIB</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-firmware-auto-loading-user-mode-helper">Disable firmware auto-loading user mode helper</h3>

<p>The firmware auto loading helper, which is a utility executed by the
  kernel on hotplug events requiring firmware, needs to be set setuid.<br />
  As a result of this, the helper utility is an attractive target for
  attackers with control of physical ports on the device.<br />
  Disabling this configuration is supported in Linux 3.9 and greater.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_FW_LOADER_USER_HELPER</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="enable-kernel-panic-on-oops">Enable Kernel Panic on OOPS</h3>

<p>When fuzzing the kernel or attempting kernel exploits attackers are
  likely to trigger kernel OOPSes.<br />
  Setting the behavior on OOPS to PANIC can impede their progress.<br />
  This configuration is supported in Linux 3.5 and greater and thus should only be enabled for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_PANIC_ON_OOPS</span><span class="o">=</span>y
</code></pre>
</div>

<h3 id="disable-socket-monitoring-interface">Disable socket monitoring interface</h3>

<p>These monitors can be used to inspect shared file descriptors on Unix
  Domain sockets or traffic on ‘localhost’ which is otherwise assumed to
  be confidential.<br />
  The <strong>CONFIG_PACKET_DIAG</strong> configuration is supported in Linux 3.7 and greater and thus should only be disabled
  for such versions.<br />
  The <strong>CONFIG_UNIX_DIAG</strong> configuration is
  supported in Linux 3.3 and greater and thus should only be disabled
  for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_PACKET_DIAG</span><span class="o">=</span>n
  <span class="nv">CONFIG_UNIX_DIAG</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-bpf-jit">Disable BPF JIT</h3>

<p>The BPF JIT can be used to create kernel-payloads from firewall table
  rules.<br />
  This configuration for is supported in
  Linux 3.16 and greater and thus should only be disabled for such
  versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">BPF_JIT</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="enable-enforced-module-signing">Enable Enforced Module Signing</h3>

<p>This configuration is supported in Linux 3.7 and greater and thus
  should only be enabled for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_MODULE_SIG_FORCE</span><span class="o">=</span>y
</code></pre>
</div>

<h3 id="disable-all-usb-pcmcia-and-other-hotplug-bus-drivers-that-arent-needed">Disable all USB, PCMCIA (and other hotplug bus) drivers that aren’t needed</h3>

<p>To reduce the attack surface, the driver enumeration, probe, and
  operation happen in the kernel.<br />
  The driver data is parsed by the kernel, so any logic bugs in these drivers can become kernel exploits.</p>

<h3 id="disable-all-file-systems-not-needed">Disable all file systems not needed</h3>

<p>To reduce the attack surface, file system data is parsed by the kernel
  so any logic bugs in file system drivers can become kernel exploits.</p>

<h3 id="kernel-address-display-restriction">Kernel Address Display Restriction</h3>

<p>When attackers try to develop “run anywhere” exploits for kernel
  vulnerabilities, they frequently need to know the location of internal
  kernel structures.<br />
  By treating kernel addresses as sensitive information, those locations are not visible to regular local users.</p>

<p>/proc/sys/kernel/kptr_restrict is set to “1” to block the reporting
  of known kernel address leaks.</p>

<p>Additionally, various files and directories should be readable only by
  the root user: /boot/vmlinuz*, /boot/System.map*,
  /sys/kernel/debug/, /proc/slabinfo</p>

<h3 id="dmesg-restrictions">DMESG Restrictions</h3>

<p>When attackers try to develop “run anywhere” exploits for
  vulnerabilties, they frequently will use dmesg output.<br />
  By treating dmesg output as sensitive information, this output is not available to
  the attacker.</p>

<p>/proc/sys/kernel/dmesg_restrict can be set to “1” to treat dmesg
  output as sensitive.</p>

<p>Enable the below compiler and linker options when building user-space
applications to avoid stack smashing, buffer overflow attacks.</p>

<h3 id="stack-smashing-attacks">Stack Smashing Attacks</h3>

<p><strong>-fstack-protector-all</strong></p>

<p>Emit extra code to check for buffer overflows, such as stack smashing
  attacks</p>

<h3 id="position-independent-executables">Position Independent Executables</h3>

<p><strong>-pie –fpic</strong></p>

<p>Produce a position independent executable on targets which supports
  it.</p>

<h3 id="detect-buffer-overflows">Detect Buffer Overflows</h3>

<p><strong>-D_FORTIFY_SOURCE=2</strong></p>

<p>Helps detect some buffer overflow errors.</p>

<h3 id="prevent-overwrite-attacks">Prevent Overwrite Attacks</h3>

<p><strong>–z,relro</strong></p>

<p>This linking option helps during program load, several ELF memory
  sections need to be written by the linker, but can be turned read-only
  before turning over control to the program. This prevents some Global
  Offset Table GOT overwrite attacks, or in the dtors section of the ELF
  binary.</p>

<p><strong>-z,now</strong></p>

<p>During program load, all dynamic symbols are resolved, allowing for the
complete GOT to be marked read-only (due to -z relro above). This
prevents GOT overwrite attacks. For very large application, this can
incur some performance loss during initial load while symbols are
resolved, but this shouldn’t be an issue for daemons.</p>

<h3 id="library-linking">Library linking</h3>

<p><strong>–static</strong></p>

<p>It is recommended that dynamic linking should not be allowed. This will
avoid user from replacing a library with malicious library. All libraries
should be linked statically.</p>

<h2 id="removal-or-non-inclusion-of-utilities">Removal or Non-Inclusion of Utilities</h2>

<p>Table below lists utilities that are typically present in an embedded
device, along with the normal path of each utility. The table has
information about whether a utility shall be included or excluded from
respective environment. The values “INCLUDE” here means to include the
utility in the environment and “EXCLUDE” means to exclude it from the
respective environment.</p>

<table>
  <thead>
    <tr>
      <th><strong>Utility Name</strong></th>
      <th><strong>Location</strong></th>
      <th><strong>Debug Environment</strong></th>
      <th><strong>Production Environment</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Strace</td>
      <td>/bin/trace</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Klogd</td>
      <td>/sbin/klogd</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Syslogd(logger)</td>
      <td>/bin/logger</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Gdbserver</td>
      <td>/bin/gdbserver</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Dropbear</td>
      <td>Remove “dropbear” from ‘/etc/init.d/rcs’</td>
      <td>EXCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>SSH</td>
      <td>NA</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Editors (vi)</td>
      <td>/bin/vi</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Dmesg</td>
      <td>/bin/dmesg</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>UART</td>
      <td>/proc/tty/driver/</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Hexdump</td>
      <td>/bin/hexdump</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Dnsdomainname</td>
      <td>/bin/dnsdomainname</td>
      <td>EXCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Hostname</td>
      <td>/bin/hostname</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Pmap</td>
      <td>/bin/pmap</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>su</td>
      <td>/bin/su</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Which</td>
      <td>/bin/which</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Who and whoami</td>
      <td>/bin/whoami</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>ps</td>
      <td>/bin/ps</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>lsmod</td>
      <td>/sbin/lsmod</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>install</td>
      <td>/bin/install</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>logger</td>
      <td>/bin/logger</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>ps</td>
      <td>/bin/ps</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>rpm</td>
      <td>/bin/rpm</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Iostat</td>
      <td>/bin/iostat</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>find</td>
      <td>/bin/find</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Chgrp</td>
      <td>/bin/chgrp</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Chmod</td>
      <td>/bin/chmod</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>Chown</td>
      <td>/bin/chown</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>killall</td>
      <td>/bin/killall</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>top</td>
      <td>/bin/top</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
    <tr>
      <td>stbhotplug</td>
      <td>/sbin/stbhotplug</td>
      <td>INCLUDE</td>
      <td>EXCLUDE</td>
    </tr>
  </tbody>
</table>

<p>Note: The following Unix/Linux utilities shall be permitted as they are
often used in the start-up scripts and for USB logging. If any of these
utilities are not required by the device then those should be removed.</p>

<p><strong>sed, awk, cut, df, dmesg, echo, fdisk, grep, mkdir, mount (vfat),
  printf, tail, tee, test (directory), test (file)</strong></p>

<h2 id="root-access">Root Access</h2>

<p>The main applications, those that provide the principal functionality of
the embedded device, <strong>should not execute</strong> with root identity or any
capability.</p>

<p>If the main application are allowed to execute at any capability,
then the entire system is at the mercy of the said application’s good
behaviour. Problems arise when an application is compromised and able to
execute commands which could consistently and persistently compromise
the system by implanting rogue applications.</p>

<p>It is suggested that the middleware and the UI should run in a context
on a user with no capability and all persistent resources should be
maintained without any capability.</p>

<p>One way to ensure this is by implementing a server-client paradigm.
Services provided by the system’s drivers can be shared this way. The
other advantage of this approach is that multiple applications can share
the same resources at the same time.</p>

<p>Root access <strong>should not be allowed</strong> for the following utilities:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  login
  su
  ssh
  scp
  sftp
</code></pre>
</div>

<p>Root access <strong>should not be allowed</strong> for the console device. The
development environment should allow users to login with pre-created
user accounts.</p>

<p>Switching to elevated privileges shall be allowed in the development
environment via sudo.</p>

<h2 id="network-hardening">Network Hardening</h2>

<h3 id="disable-ipv4-forwarding">Disable IPv4 Forwarding</h3>

<p>The net.ipv4.ip_forward sysctl setting controls if IP forwarding is
  allowed or not on the System. Unless the system is used as a router or
  gateway, IPv4 forwarding should be disabled.</p>

<h3 id="disable-ip-source-routing">Disable IP Source Routing</h3>

<p>Disable IP source routing on all interfaces through the
  net.ipv4.conf.*.accept_source_route = 0 setting.</p>

<p>IP source routing would allow a remote user (the sender) to specify
  the route that the packet should take, rather than use the (default)
  routing tables used by the routers between the sender and the
  destination. This could be used to spoof IP addresses and still get
  the replies (rather than sending the replies to the real owner of the
  IP address).</p>

<h3 id="disable-icmp">Disable ICMP</h3>

<p>Use of ICMP, especially ping, shall be avoided. This is a common way
  of gaining access to a system.</p>

<h4 id="disable-icmp-redirects">Disable ICMP Redirects</h4>

<p>Set net.ipv4.conf.*.accept_redirects=0 to disable ICMP redirect
  support on the interfaces.</p>

<p>ICMP redirect messages are used by routers to inform hosts to use a
  different gateway than the one used. These packets should only be sent
  by the gateway of the system. In managed and embedded devices the
  gateway is controlled and any changes should be controlled.</p>

<p>Allowing ICMP redirect messages would allow for “remote” updating of
  the routing table, which could allow an attacker to get all packets
  sent to the outside first rather than the packets immediately going to
  the real gateway.</p>

<h4 id="ignore-icmp-echo-broadcasts">Ignore ICMP Echo Broadcasts</h4>

<p>When net.ipv4.icmp_echo_ignore_broadcasts=1 is set, then your
  system will not reply to broadcast “ping” requests.</p>

<h4 id="ignore-icmp-bogus-error-responses">Ignore ICMP Bogus Error Responses</h4>

<p>When an invalid response is given to broadcast frames (which occurs
  sometimes in erroneous routers), the Linux kernel will by default log
  this event. These can be disabled by setting
  throughnet.ipv4.icmp_ignore_bogus_error_responses to 1.</p>

<h3 id="ignore-all-broadcast-message">Ignore all broadcast message</h3>

<p>All the IP packets that come on the address “255.255.255.255” shall be
  ignored. This can be done through the iptables rules.</p>

<h3 id="disable-ipv6">Disable IPV6</h3>

<p>If there are no plans of using IPV6, it is a good practice to disable
  this support as it will reduce the size of the kernel TCP/IP stack.</p>

<h3 id="enable-tcp-syn-cookie-protection">Enable TCP SYN Cookie Protection</h3>

<p>One way of denial of service (DoS) attack against a service would be
  to flood the server with SYNrequests (the TCP packet that starts a
  handshake for a connection). Such a flood can lead to a service
  disruption as the connection state handling will consume significant
  resources.</p>

<p>By enabling net.ipv4.tcp_syncookies, the Linux kernel will change its
  handshake behavior when its SYN backlog queue overflows: it replies to
  SYN requests with the appropriate SYN+ACK reply, but it does not store
  the connection in its backlog queue.</p>

<h1 id="validation">Validation</h1>

<h2 id="hardened-system-1">Hardened System</h2>

<h3 id="image-security-analysis-framework-isafw">Image Security Analysis Framework (ISAFW)</h3>

<p><strong>meta-security-isafw</strong> is an OE layer that allows enabling the Image
Security Analysis Framework (isafw) for your image builds.</p>

<p>The primary purpose of isafw is to provide an extensible
framework for analysing different security aspects of images
during the build process.</p>

<p>The isafw project itself can be found at
    https://github.com/01org/isafw</p>

<p>This layer can be added to your builds to produce an analysis report,
including a kernel config analysis.</p>

<h3 id="usage">Usage</h3>

<p>In order to enable the isafw during the image build, please add
the following line to your build/conf/local.conf file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">INHERIT</span> <span class="o">+=</span> <span class="s">"isafw"</span>
</code></pre>
</div>



                </div>
            </div>
        </div>
        <div class="row">
            <div class="blue-divider"></div>
<footer>
    <div class="container-fluid">
        <div class="row">
    <div class="col-sm-9">
        <h1>More Resources</h1>
        <div class="row">
            <div class="col-sm-4">
                <h2>General</h2>
                <ul class="nav">
                    <li>
                        <a target="_blank" href="https://www.automotivelinux.org/">AGL Developer Community</a>
                    </li>
                    <li>
                        <a href="https://www.automotivelinux.org/software/download/">Download Distribution</a>
                    </li>
                    <li>
                        <a href="https://gerrit.automotivelinux.org/gerrit/#/admin/projects/">Source Code on Git</a>
                    </li>
                    <li>
                        <a target="_blank" href="/contact">Mailing List</a>
                    </li>
                </ul>
            </div>
            <div class="col-sm-4">
                <h2>Development</h2>
                <ul class="nav">
                    <li><a target="_blank" href="https://wiki.automotivelinux.org/agl-distro/source-code">Source Code</a></li>
                    <li><a target="_blank" href="https://jira.automotivelinux.org/browse/SPEC/?selectedTab=com.atlassian.jira.jira-projects-plugin:summary-panel">Issue Tracker</a></li>
                    <li><a target="_blank" href="https://wiki.automotivelinux.org/">Wiki</a></li>
                    <li><a href="https://www.automotivelinux.org/contact-us">Contact</a></li>
                </ul>
            </div>
            <div class="col-sm-4">
                <h2>Automotive Grade Linux @ Linux Foundation</h2>
                <ul class="nav">
                    <li>
                        <a target="_blank" href="https://www.automotivelinux.org/">About AGL</a>
                    </li>
                    <li>
                        <a target="_blank" href="http://www.linuxfoundation.org/">About Linux Foundation</a>
                    </li>
                    <li>
                        <a target="_blank" href="https://wiki.automotivelinux.org/start/getting-started">Join AGL community</a>
                    </li>
                    <li>
                        <a target="_blank" href="https://www.automotivelinux.org/about/members">Members</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-sm-3">
        <h1>Contribute</h1>
        <p style="padding-top:20px"><strong>Help AGL move forward!</strong></p>
        <p>Report bugs, improve the docs, or contribute to the code.</p>
        <a href="/contribute" class="btn btn-lg btn-primary">
            Learn More
        </a>
        <p style="padding-top:20px"> <a href="https://twitter.com/autogradelinux" class="twitter-follow-button" data-show-count="false">Follow @autogradelinux</a></p>
    </div>
</div>
<div class="row">
	<div class="col-sm-9">
		<p class="copyright_text">
			Copyright &copy; 2015-2018 Automotive Grade Linux Documentation, Licensed under the <a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
			<br/>
			Automotive Grade Linux and logos are <a target="_blank" href="http://www.linuxfoundation.org">trademarks</a> of The Linux Foundation.
			<br/>
			Initial site design from <a href="https://cordova.apache.org/">Cordova website.</a> - warm thanks !
		</p>
	</div>
    <div class="col-sm-3">
		<small class="stats">Page rendered at:  2018-07-11 00:07:34 +0000</small>
		
		<br/><small class="stats"><a href="https://raw.githubusercontent.com/automotive-grade-linux/docs-agl/master/docs/sec-blueprint/07-system-hardening.md">Link to source document</small>
		
	</div>
</div>

    </div>
</footer>

        </div>
    </div>
</div>

<script defer type="text/javascript" src="/static/js/lib/toc.min.js"></script>
<script defer type="text/javascript" src="/static/js/docs.js"></script>

    <script defer type="text/javascript" src="/static/js/twitter.js"></script>
    



<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<script type="text/javascript">
    docsearch({
        apiKey: 'edd30bcff9f6df4b095c41cba3e5a418',
        indexName: 'automotivelinux',
        inputSelector: '#header-search-field',
    });
</script>

            
    

</body>
</html>
